# Отчёт по ревью кода

Стиль: просто, явно, одна функция = одна задача. Замечания сгруппированы по модулям. Приоритеты: P0 — критично, P1 — важно, P2 — можно позже.

## main.py

- P1: Закомментированный код запуска тестов в `main()` засоряет точку входа. Вынести в отдельную CLI-опцию.
- P2: Нет проверки окружения (права/экран/браузер). Можно добавить лёгкую предварительную проверку и подсказки.

## core/chat_manager.py

- P1: Много прямых вызовов `pyautogui` без централизованной обработки ошибок/повторов. Предложение: тонкий обёрточный метод для нажатий/кликов c ретраями.
- P2: `rename_current_chat` опирается на несколько координат и ветвится. Часть логики можно сделать явной (валидация наличия координат до действий).

## core/file_handler.py

- P0: Несоответствие формата данных между `load_prompts()` и использованием в `test_new_format()`. Сейчас `load_prompts()` возвращает `dict[int, (str, list[dict])]`, а тест ожидает итерироваться как по списку пар. Нужно привести к единому формату и обновить тесты.
- P1: Регулярка жёстко связана с русским форматом строк. Нужна чёткая валидация и понятная ошибка пользователю, + краткая спецификация формата во `docs/USER_GUIDE.md`.
- P2: Логи — mix `print` и структурные сообщения. Имеет смысл унифицировать через `Logger`.

## core/image_generator.py

- P1: Проверка пикселя `pyautogui.pixel` хрупкая. В коде есть толеранс, но нет fallback на «ожидание по времени» как в мультиформатном генераторе.
- P1: Сильная связность с `ChatManager` и координатами. Добавить раннюю проверку критичных координат до цикла.

## core/multi_format_generator.py

- P1: Отличная детализация логов, есть fallback’ы на None. Стоит вынести повторяющиеся ожидания в маленькие функции (небольшой рефактор без усложнения).
- P2: Имена файлов/чатов генерируются в нескольких местах. Можно вынести строители имён в функции утилит.

## ui/console.py

- P2: Вывод длинный и статичный. Перенести список хоткеев в одно место (источник правды), чтобы не расходился с `hotkeys.py`.

## ui/hotkeys.py

- P1: Много интерактивного `input` в координатном меню — ок. Нужен таймаут/escape-путь для headless/CLI-режима (минимально: проверка `stdin.isatty()`).

## utils/clipboard.py

- P1: Хорошо, что буфер восстанавливается. Добавить «жёсткий» fallback на повтор `ctrl+v`, если вставка не сработала (опционально по флагу).

## utils/logger.py

- P2: Минимальный логгер ок. Добавить уровень логов и простой переключатель формата (краткий/подробный) через настройки.

## utils/process_manager.py

- P1: Проверки координат и движений — хорошо. Добавить явный вывод недостающих координат для текущего режима (уже частично есть) и ссылку на `Ctrl+0`.
- P1: Старт двух разных воркеров — норма. Желательно нормализовать передачу настроек (часть читается из `DELAYS`, часть из `SettingsManager`).

## utils/window_manager.py

- P1: Поиск окон/создание работает, но есть жёсткие пути к браузерам. Добавить проверку наличия и подсказки по установке, плюс настройку кастомного пути в `settings.json` (необязательно, но полезно).
- P2: Проверка активного окна через движение мыши — хрупко. Рассмотреть проверку через `pygetwindow` только.

## config/coordinates.py

- P1: Отлично, что есть `CoordinatesManager`. Стоит централизовать проверку «нулевых» координат и формировать понятный список «что надо настроить» для текущего режима.
- P2: Значения задержек хардкодно в модуле. Часть уже синхронизируется из настроек — продолжить в этом же духе.

## config/settings.py

- P0: Несогласованность с `tests/test_suite.py` (часть тестов ожидает иной формат `load_prompts`). Нужно зафиксировать единую структуру данных и обновить тесты.
- P1: Методы `configure_*` взаимодействуют с пользователем через `input`. Для автотестов можно добавить неблокирующие варианты (параметризованные методы или флаг «non-interactive»).

## tests/test_suite.py

- P0: Тесты устарели относительно текущего формата данных промптов. Исправить ожидания (имена чатов/файлов и структура данных).
- P2: Некоторые тесты зависят от UI (ожидаемые падения/исключения). Добавить пометки и быстрый пропуск (скоро в бэклоге).

---

## Общие рекомендации

- Ввести единый формат данных для промптов и зафиксировать его в `docs/USER_GUIDE.md` и `docs/DEVELOPER_GUIDE.md`.
- Удалить/сократить закомментированный код, который дублируется в документации или тестовых сценариях.
- Централизовать логи через `Logger` и настроечные флаги.
- Развести интерактивные и неинтерактивные пути (CLI-флаги, быстрая проверка окружения).

