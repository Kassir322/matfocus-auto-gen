# Руководство разработчика

Принципы: простота, минимализм, явность, одна функция = одна задача.

## Структура проекта (кратко)

- `main.py` — точка входа
- `config/` — настройки и координаты
- `core/` — бизнес-логика (чат, генераторы, парсер)
- `ui/` — консоль и горячие клавиши
- `utils/` — утилиты: буфер, логгер, процессы, окна
- `tests/` — тесты (ручные/полуручные)
- `data/` — пользовательские файлы

## Настройки

- `config/settings.py` — `SettingsManager`
  - Сохраняет `settings.json`
  - Синхронизирует `GENERATION_WAIT` с `DELAYS`
  - Имеет интерактивные `configure_*` методы
- `config/coordinates.py` — `CoordinatesManager`
  - Хранит `coordinates.json`
  - Экспортирует `COORDINATES`, `RELATIVE_MOVEMENTS`, `DELAYS`

## Формат данных промптов

Единый формат (см. `docs/USER_GUIDE.md`). Возвращаемая структура парсера должна быть в одном виде во всём проекте.
Рекомендуемая структура:

```python
# dict[int, tuple[str, list[dict]]]
# card_num -> (card_name, [ {'лицо': str, 'оборот': str}, ... ])
```

## Логирование

- Используем `utils/logger.py` (`Logger`)
- Не смешиваем `print` и логи — всё через `Logger` (кроме стартовых сообщений)
- Добавлять уровни логов по мере необходимости (позже)

## Обработка ошибок

- Явно логируем ошибки с контекстом (какая координата/шаг/параметры)
- Минимизируем `try/except` вокруг больших блоков — лучше узкие зоны
- Не скрываем исключения без сообщения

## UI-автоматизация

- Все координаты/движения — из `config/coordinates.py`
- Критичные координаты проверяем заранее (до запуска цикла)
- Для нестабильных действий допускаем простые ретраи (2–3 попытки)

## Генераторы

- `core/image_generator.py` — стандартный режим
- `core/multi_format_generator.py` — мультиформатный режим
- Общие куски (ожидания, имена файлов/чатов) — выносить в маленькие функции

## Тесты

- `tests/test_suite.py` — ручные/полуавтоматические проверки
- Избегаем зависаний `input()` в тестах (проверять `stdin.isatty()` либо мокать)
- Тесты на формат промптов должны соответствовать актуальному парсеру

## Гайды по доработкам

- Не удаляем старые комментарии, можно только дополнять
- Избегаем усложнений: никаких фабрик/DI/метаклассов
- Имена переменных — полные и понятные (`prompt_text`, не `pt`)
- Небольшие функции с явными именами

## Быстрый чеклист PR

- Настройки загружаются? Координаты заданы?
- Формат промптов стабилен и задокументирован?
- Логи читаемы, без лишних `print`?
- Нет блокирующих `input()` в неинтерактивных путях?
- Тесты соответствуют текущему формату?

